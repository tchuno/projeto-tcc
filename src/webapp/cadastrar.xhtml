<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:gnfe="http://java.sun.com/jsf/composite/gnfe">
<h:head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>#{msg['appName.label']}</title>
    <link href="#{request.contextPath}/resources/images/favicon-gnfe.png" rel="shortcut icon"/>
    <link href="#{request.contextPath}/resources/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="#{request.contextPath}/resources/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="#{request.contextPath}/resources/css/animate.css" rel="stylesheet"/>
    <link href="#{request.contextPath}/resources/css/main.css" rel="stylesheet"/>
    <script src="#{request.contextPath}/resources/js/jquery.js" type="text/javascript"></script>
    <script src="#{request.contextPath}/resources/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="#{request.contextPath}/resources/js/jquery.mask.min.js" type="text/javascript"></script>
    <script src="#{request.contextPath}/resources/js/main.js" type="text/javascript"></script>
    <ui:insert name="head"/>
    <gnfe:customizacao/>
</h:head>
<h:body>
    <f:metadata>
        <f:viewParam name="id" value="#{usuarioEditBean.id}"/>
        <f:event type="preRenderView" listener="#{usuarioEditBean.init}" />
    </f:metadata>
    <p:ajaxStatus onstart="$('#ajaxLoaderImg').show()" onsuccess="$('#ajaxLoaderImg').hide()"/>
    <div id='ajaxLoaderImg' style="position: absolute; right: 0; bottom: 80px; display: none; z-index: 9999;">
        <img src="#{request.contextPath}/resources/images/loader.gif"/>
    </div>
    <div id="wrapper">
        <div id="header">
            <header class="navbar navbar-inverse navbar-fixed-top wet-asphalt" role="banner">
                <div class="container containerLogo">
                    <div class="navbar-header">
                        <a class="navbar-brand logo2" href="#{request.contextPath}">
                            <IMG src="#{request.contextPath}/resources/images/logo-gnfe-transparent.png"
                                 style="opacity: 0.7;"/>
                        </a>
                    </div>
                </div>
            </header>
            <section id="title" class="emerald">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12">
                            <h1><h:outputText value="#{msg['cadastrar.label']}"/></h1>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <h:panelGroup id="content-pg-id">
            <div id="content">
                <section class="container">
                    <b:messages globalOnly="true" showSummary="true" id="mensagensGlobais"/>
                    <script type="text/javascript">
                        jQuery(function($) {
                            hideMessage(4000);
                            var mensagensGlobais = $('#mensagensGlobais');
                            if(mensagensGlobais.html()) {
                                $('html,body').animate({
                                    scrollTop: mensagensGlobais.offset().top - 80
                                }, 500);
                            }
                        });
                    </script>
                    <h:form id="form-usuario">
                        <section id="usuario-page" class="container">
                            <div class="row">
                                <div class="col-sm-12">
                                    <h4 class="tituloForm"><h:outputText value="#{msg['usuarioForm.label']}"/></h4>
                                    <div class="row">
                                        <div class="col-sm-8">
                                            <div class="form-group">
                                                <b:inputText value="#{usuarioEditBean.usuario.nome}"
                                                             label="#{msg['nome.label']}" renderLabel="true" required="true"
                                                             maxlength="40"  />
                                                <b:message/>
                                            </div>
                                            <div class="form-group">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <b:inputText id="loginId" value="#{usuarioEditBean.usuario.login}" required="true"
                                                                     label="#{msg['login.label']}" renderLabel="true" maxlength="100" style="text-transform: lowercase;" >
                                                        </b:inputText>
                                                        <b:message/>
                                                    </div>
                                                    <div class="col-md-8">
                                                        <b:inputText id="emailId" value="#{usuarioEditBean.usuario.email}"
                                                                     label="#{msg['email.label']}" renderLabel="true"
                                                                     maxlength="100" required="true"
                                                                     validatorMessage="#{msg['emailInvalido.error']}" >
                                                            <f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
                                                        </b:inputText>
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <b:inputText value="#{usuarioEditBean.usuario.cpf}"
                                                                     label="#{msg['cpf.label']}" renderLabel="true" disabled="#{usuarioEditBean.id ne null}"
                                                                     styleClass="mask-cpf" required="true" />
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <b:inputText value="#{usuarioEditBean.usuario.telefone}"
                                                                     label="#{msg['telefone.label']}" renderLabel="true"
                                                                     maxlength="15"
                                                                     styleClass="mask-phone" />
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <b:inputText value="#{usuarioEditBean.usuario.cep}"
                                                                     label="#{msg['cep.label']}" renderLabel="true"
                                                                     maxlength="15" id="cep"
                                                                     styleClass="mask-cep" />
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <b:inputText value="#{usuarioEditBean.usuario.endereco}" id="rua"
                                                                     label="#{msg['endereco.label']}" renderLabel="true"/>
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <b:inputText value="#{usuarioEditBean.usuario.numero}"
                                                                     label="#{msg['numero.label']}" renderLabel="true" styleClass="mask-number"/>
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <b:inputText value="#{usuarioEditBean.usuario.bairro}" id="bairro"
                                                                     label="#{msg['bairro.label']}" renderLabel="true"/>
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <b:inputText value="#{usuarioEditBean.usuario.cidade}" id="cidade"
                                                                     label="#{msg['cidade.label']}" renderLabel="true"/>
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <b:inputText value="#{usuarioEditBean.usuario.estado}" id="estado"
                                                                     label="#{msg['estado.label']}" renderLabel="true"/>
                                                        <b:message/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <b:commandButton value="#{msg['cadastrar.label']}" styleClass="btn btn-primary btn-lg" actionListener="#{usuarioEditBean.cadastrar()}" ajax="true" update="content-pg-id"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </h:form>
                    <script type="text/javascript">

                        $(document).ready(function() {

                            function limpa_formulário_cep() {
                                // Limpa valores do formulário de cep.
                                $("#input_form-usuario\\:rua").val("");
                                $("#input_form-usuario\\:bairro").val("");
                                $("#input_form-usuario\\:cidade").val("");
                                $("#input_form-usuario\\:estado").val("");
                            }

                            //Quando o campo cep perde o foco.
                            $("#input_form-usuario\\:cep").blur(function() {

                                //Nova variável "cep" somente com dígitos.
                                var cep = $(this).val().replace(/\D/g, '');

                                //Verifica se campo cep possui valor informado.
                                if (cep != "") {

                                    //Expressão regular para validar o CEP.
                                    var validacep = /^[0-9]{8}$/;

                                    //Valida o formato do CEP.
                                    if(validacep.test(cep)) {

                                        //Preenche os campos com "..." enquanto consulta webservice.
                                        $("#input_form-usuario\\:rua").val("...");
                                        $("#input_form-usuario\\:bairro").val("...");
                                        $("#input_form-usuario\\:cidade").val("...");
                                        $("#input_form-usuario\\:estado").val("...");

                                        //Consulta o webservice viacep.com.br/
                                        $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {

                                            if (!("erro" in dados)) {
                                                //Atualiza os campos com os valores da consulta.
                                                $("#input_form-usuario\\:rua").val(dados.logradouro);
                                                $("#input_form-usuario\\:bairro").val(dados.bairro);
                                                $("#input_form-usuario\\:cidade").val(dados.localidade);
                                                $("#input_form-usuario\\:estado").val(dados.uf);
                                            } //end if.
                                            else {
                                                //CEP pesquisado não foi encontrado.
                                                limpa_formulário_cep();
                                                alert("CEP não encontrado.");
                                            }
                                        });
                                    } //end if.
                                    else {
                                        //cep é inválido.
                                        limpa_formulário_cep();
                                        alert("Formato de CEP inválido.");
                                    }
                                } //end if.
                                else {
                                    //cep sem valor, limpa formulário.
                                    limpa_formulário_cep();
                                }
                            });
                        });

                        jQuery(function($) {
                            configurarMascaras();
                            configurarDatePicker();
                        });
                    </script>
                </section>
            </div>
        </h:panelGroup>
    </div>
</h:body>
</html>
